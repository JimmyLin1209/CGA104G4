<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- 響應式頁面 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- GOOGLEFONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">

    <!-- 下面是這個模板需要的css請勿改動 若有排版需要請直接寫新的css蓋過去就可以了 -->
    <link rel="stylesheet" type="text/css" href="../resources/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/slick.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/slick-theme.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/flaticon.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/style.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/nav.css">
    <!-- 已經預載入jquery了有需要jquery可以直接使用 -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <!-- 請將覆蓋用的css放置此註解下方 -->
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:400,500,700,300,100);
        /*** Table Styles **/
        span {
            color: #0a0a0a;
            text-align: center

        }

        .flexdiv {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
        }

        button {
            border: 0;
            background-color: #4E5066FF;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
        }

        button:hover {
            color: #000000FF;
            background-color: #4E5066FF;
            border: 2px #003C9D solid;
        }

        select {
            /* Reset */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 0;
            outline: 0;
            font: inherit;
            /* Personalize */
            width: 20em;
            height: 3em;
            padding: 0 4em 0 1em;
            background: url(https://upload.wikimedia.org/wikipedia/commons/9/9d/Caret_down_font_awesome_whitevariation.svg) no-repeat right 0.8em center/1.4em, linear-gradient(to left, rgb(78, 80, 102) 3em, rgb(0, 0, 0) 3em);
            color: #ffffff;
            border-radius: 0.25em;
            box-shadow: 0 0 1em 0 rgba(0, 0, 0, 0.2);
            cursor: pointer;
            /* <option> colors */
            /* Remove focus outline */
            /* Remove IE arrow */
        }

        select option {
            color: inherit;
            background-color: #000000;
        }

        select:focus {
            outline: none;
        }

        select::-ms-expand {
            display: none;
        }

        .table-fill {
            background: white;
            border-radius: 3px;
            border-collapse: collapse;
            height: 320px;
            margin: auto;
            padding: 5px;
            width: 100%;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            animation: float 5s infinite;
        }

        th {
            color: #D5DDE5;;
            background: #1b1e24;
            border-bottom: 4px solid #9ea7af;
            border-right: 1px solid #343a45;
            font-size: 23px;
            font-weight: 100;
            padding: 24px;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            vertical-align: middle;
        }

        th:first-child {
            border-top-left-radius: 3px;
        }

        th:last-child {
            border-top-right-radius: 3px;
            border-right: none;
        }

        tr {
            border-top: 1px solid #C1C3D1;
            border-bottom-: 1px solid #C1C3D1;
            color: #666B85;
            font-size: 16px;
            font-weight: normal;
            text-shadow: 0 1px 1px rgba(256, 256, 256, 0.1);
            text-align: center
        }

        tr:hover td {
            background: #4E5066;
            color: #FFFFFF;
            border-top: 1px solid #22262e;
        }

        tr:first-child {
            border-top: none;
        }

        tr:last-child {
            border-bottom: none;
        }

        tr:nth-child(odd) td {
            background: #EBEBEB;
        }

        tr:nth-child(odd):hover td {
            background: #4E5066;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 3px;
        }

        tr:last-child td:last-child {
            border-bottom-right-radius: 3px;
        }

        td {
            background: #FFFFFF;
            padding: 20px;
            text-align: center;
            vertical-align: middle;
            font-weight: 300;
            font-size: 18px;
            text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);
            border-right: 1px solid #C1C3D1;

        }

        td:last-child {
            border-right: 0px;
        }


    </style>

    <!-- 頁籤顯示的title -->
    <title>搜尋合作店家</title>


</head>

<body>
<script src="../resources/js/membernav.js"></script>
<!-- 上面是NAV載入 請一定要放在BODY開始的位置 -->
<!--下面可自由新增內容 -->
<div style="height: 90px"></div>
<div id="page-wrapper">
    <div id="wrapper-container">
        <!-- ******內容寫在這邊 ↓↓↓****** -->
        <div class="flexdiv">
            <div display="">
                <span style="color: #0a0a0a">選擇合作店家名稱:</span>
                <select id="storeNameSelector" name="storeName"></select>
            </div>
            <div>
                <span style="color: #0a0a0a">選擇合作店家地區:</span>
                <select id="storeCitySelector" name="storeCity"></select>
            </div>
            <div>
                <button style="margin: auto;" id="getAll">顯示所有合作店家</button>
            </div>
        </div>
        <div id="listTable" style="margin-left: 0.5rem;margin-right: 0.5rem;display: inline;"></div>
        <!-- ******內容寫在這邊 ↑↑↑****** -->
    </div>
</div>
</body>

<script>

    //儲存合作店家名稱陣列
    let storeNameArray = [];

    //頁面載入取得合作店家名稱選單
    (async function getStoreName() {
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=getStoreName";
        let response = await fetch(url, {method: 'get'});
        storeNameArray = await response.json();
        $("#storeNameSelector").empty().append(`<option value="none" selected disabled hidden>請選擇店家</option>`);
        storeNameArray.forEach(storeName => {
            $("#storeNameSelector").append(`<option  value="${storeName}">${storeName}</option>`)
        })
    })();

    let storeCityArray = [];

    (async function getStoreCity() {
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=getStoreCity";
        let response = await fetch(url, {method: 'get'});
        storeCityArray = await response.json();
        $("#storeCitySelector").empty().append(`<option value="none" selected disabled hidden>請選擇地區</option>`);
        storeCityArray.forEach(storeCity => {
            $("#storeCitySelector").append(`<option  value="${storeCity}">${storeCity}</option>`)
        })
    })();

    //綁定合作店家名稱選單查詢按鈕點擊事件
    $("#storeNameSelector").change(selectByName);

    //透過選單查詢合作店家資料
    async function selectByName() {
        let storeName = $("#storeNameSelector").val();
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=selectByName&storeName=" + storeName;
        let response = await fetch(url, {method: 'get'});
        let stores = await response.json();
        listStore(stores);
    }

    //綁定合作店家名稱選單查詢按鈕點擊事件
    $("#storeCitySelector").change(selectByCity);

    async function selectByCity() {
        let storeCity = $("#storeCitySelector").val();
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=selectByCity&storeCity=" + storeCity;
        let response = await fetch(url, {method: 'get'});
        let stores = await response.json();
        listStore(stores);
    }

    // 綁定顯示所有合作店家資料按鈕事件

    $("#getAll").click(getAll)
    async function getAll() {
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=getAll";

        let response = await fetch(url, {method: 'get'});
        let stores = await response.json();
        listStore(stores);

    };

    //取得所有會員資料
        window.onload = async function getAllOnload() {
        let path = window.location.pathname;
        let webCtx = path.substring(0, path.indexOf('/', 1));
        let url = webCtx + "/store/storeFront.do?action=getAll";

        let response = await fetch(url, {method: 'get'});
        let stores = await response.json();
        listStore(stores);

    };

    //動態生成表格
    function listStore(stores) {
        //移除原本存在的表格
        $("#listTable").empty();
        //生成表格

        let table = document.createElement("table");
        //生成表頭

        table.innerHTML += "<thead><tr><th>編號</th>"
            + "<th>名稱</th><th>電話</th><th>縣市</th><th>區域</th><th>路段</th>"
            + "<th>照片</th><th>前往店家</th></tr></thead>";
        //生成表格內容

        let tbody = document.createElement("tbody");
        //循環依人數生成表格數量
        for (let i = 0; i < stores.length; i++) {
            //修改會員狀態顯示結果不顯示數字而是文字

            let tr = document.createElement("tr");
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeId}</td>`);
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeName}</td>`);
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeTel}</td>`);
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeCity ? stores[i].storeCity : ""}</td>`);
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeDist ? stores[i].storeDist : ""}</td>`);
            tr.insertAdjacentHTML("beforeend", `<td>${stores[i].storeAdr ? stores[i].storeAdr : ""}</td>`);
            if (stores[i].storePic) {
                tr.insertAdjacentHTML("beforeend", `<td><img width="150" height="200" class="storePic" src=data:image/jpeg;base64,${stores[i].storePic}></td>`);
            } else {
                tr.insertAdjacentHTML("beforeend", `<td></td>`);
            }
            tr.insertAdjacentHTML("beforeend", `<td><a href="../prod/prod.do?action=listProdTypeIds_ByStoreId_M&storeId=${stores[i].storeId}">前往店家</a></td>`);
            tbody.append(tr);

        }
        table.append(tbody);
        table.setAttribute("class", "table-fill");
        $("#listTable").append(table);
    }

</script>


<!-- 下面是這個版需要的js可添加各自需要的js檔-->
<script src="../resources/js/bootstrap.min.js"></script>
<script src="../resources/js/slick.js"></script>
<script src="../resources/js/scripts.js"></script>
<script src="../resources/js/isotope.js"></script>

</body>

</html>